# –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã DAG –≤ Airflow

https://korsak0v.notion.site/Data-Engineer-185c62fdf79345eb9da9928356884ea0

## –û –≤–∏–¥–µ–æ

üî• –•–æ—á–µ—à—å, —á—Ç–æ–±—ã DAG‚Äô–∏ –≤ Airflow –≤–µ–ª–∏ —Å–µ–±—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ, –Ω–µ –ø–∞–¥–∞–ª–∏ ¬´–Ω–∏ —Å —Ç–æ–≥–æ –Ω–∏ —Å —Å–µ–≥–æ¬ª –∏ –≤–µ–ª–∏ —Å–µ–±—è –ø–æ‚Äë—Ä–∞–∑–Ω–æ–º—É –≤
–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–¥–∞—á–∏? –í —ç—Ç–æ–º [–≤–∏–¥–µ–æ](https://youtu.be/VdGQ0819GM0) —Ä–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ –ø–æ—à–∞–≥–æ–≤–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å DAG –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π
–∫–µ–π—Å ‚Äî –æ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—á–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–æ –ø—Ä–æ–¥–æ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ retries, owner, timeout, pools –∏ –¥–∞—Ç –∑–∞–ø—É—Å–∫–∞.

–°—Å—ã–ª–∫–∏:

- –ú–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ/–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ Data
  Engineering ‚Äî https://korsak0v.notion.site/Data-Engineer-185c62fdf79345eb9da9928356884ea0
- TG-–∫–∞–Ω–∞–ª ‚Äî https://t.me/DataLikeQWERTY
- Instagram ‚Äî https://www.instagram.com/i__korsakov/
- Habr ‚Äî https://habr.com/ru/users/k0rsakov/publications/articles/

üîç –ß—Ç–æ –≤ –≤–∏–¥–µ–æ:

- üß† –ß—Ç–æ —Ç–∞–∫–æ–µ DAG –≤ Apache Airflow –∏ –∫–∞–∫–∏–µ –±–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω—É–∂–Ω–æ —Ç—Ä–æ–≥–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å
- ‚öôÔ∏è –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ-–ø–æ–ª–µ–∑–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è DAG: —á—Ç–æ –∑–∞–¥–∞—Ç—å –≤ default_args, —á—Ç–æ–±—ã –æ–Ω –≤–æ–æ–±—â–µ –≤—ë–ª —Å–µ–±—è –∞–¥–µ–∫–≤–∞—Ç–Ω–æ
- üîÅ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç retries –∏ retry_delay: –ø–æ—á–µ–º—É —Ç–∞—Å–∫–∞ –º–æ–∂–µ—Ç ¬´–≤–æ—Å–∫—Ä–µ—Å–∞—Ç—å¬ª –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∏ –∫–∞–∫ —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ
- üí• –§—É–Ω–∫—Ü–∏—è zero_division –∏ DAG, –∫–æ—Ç–æ—Ä—ã–π –≤—Å–µ–≥–¥–∞ –ø–∞–¥–∞–µ—Ç: –∫–∞–∫ –Ω–∞ —Ç–∞–∫–æ–º –ø—Ä–∏–º–µ—Ä–µ —Ä—É–∫–∞–º–∏ —É–≤–∏–¥–µ—Ç—å —Ä–∞–±–æ—Ç—É —Ä–µ—Ç—Ä–∞–µ–≤ –∏ –ª–æ–≥–æ–≤
- üë§ –ê—Ç—Ä–∏–±—É—Ç owner –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: –∫–∞–∫ –ø–æ–≤–µ—Å–∏—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ç–∞—Å–∫—É –∏ –ø–æ—á–µ–º—É —ç—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è
  –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞
- ‚è±Ô∏è execution_timeout: —á–µ–º –æ–Ω –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ timeout –∏ –∫–∞–∫ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –∑–∞–¥–∞—á–∏
- üßµ –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Ä–æ–≤–Ω—è DAG ¬´–ø—Ä–æ–∫–∏–¥—ã–≤–∞—é—Ç—Å—è¬ª –≤ —Ç–∞—Å–∫–∏ –∏ –∫–∞–∫ –∏—Ö –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ—á–µ—á–Ω–æ
- üèä –ü—É–ª—ã (pool) –≤ Airflow: –∫–∞–∫ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∞—Å–∫–∏ –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —ç—Ç–æ –≤ Cluster Activity
- üìÖ start_date –∏ end_date: –∫–∞–∫ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–µ—Ä–∏–æ–¥ –∂–∏–∑–Ω–∏ DAG –∏ –∫–æ–≥–¥–∞ —ç—Ç–æ –Ω—É–∂–Ω–æ –≤ –±–æ–µ–≤—ã—Ö –ø–∞–π–ø–ª–∞–π–Ω–∞—Ö
- üì® –ü–æ—á–µ–º—É –æ–¥–Ω–∏ DAG‚Äô–∏ —à–ª—é—Ç –æ—à–∏–±–∫–∏ –Ω–∞ –ø–æ—á—Ç—É, –∞ –¥—Ä—É–≥–∏–µ –Ω–µ—Ç, –∏ –∫–∞–∫ —ç—Ç–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- üß© –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: –∫–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã DAG‚Äô–∞ —Å—Ç–æ–∏—Ç –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø–æ–¥ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, –∞ –Ω–µ –æ—Å—Ç–∞–≤–ª—è—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

üóÇÔ∏è GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –∫–æ–¥–æ–º: https://github.com/k0rsakov/pet_project_how_to_set_up_dag_settings_in_airflow

‚úâÔ∏è –í–æ–ø—Ä–æ—Å—ã, –æ–±—É—á–µ–Ω–∏–µ, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ ‚Äî –ø–∏—à–∏ –≤ –ª–∏—á–∫—É:
https://korsak0v.notion.site/Data-Engineer-185c62fdf79345eb9da9928356884ea0

üí° –í –∫–æ–Ω—Ü–µ –≤–∏–¥–µ–æ ‚Äî —á–µ–∫-–ª–∏—Å—Ç, –∫–∞–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DAG –≤ Airflow –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–π—Ç–∏—Å—å –≥–æ–ª–æ–≤–æ–π –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–º: —á—Ç–æ –∑–∞–¥–∞—Ç—å
–≥–ª–æ–±–∞–ª—å–Ω–æ, —á—Ç–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∞—Å–∫–∏ –∏ –∫–∞–∫ –Ω–µ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –ø–∞–π–ø–ª–∞–π–Ω—ã –≤ —Ä–∞–Ω–¥–æ–º–Ω—É—é –ª–æ—Ç–µ—Ä–µ—é —Å –ø–∞–¥–µ–Ω–∏—è–º–∏ –∏ –≤–µ—á–Ω—ã–º–∏
—Ä–µ—Ç—Ä–∞—è–º–∏.

–¢–∞–π–º–∫–æ–¥—ã:

- 00:00 ‚Äì –ù–∞—á–∞–ª–æ
- 00:16 ‚Äì –ü—Ä–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
- 01:23 ‚Äì –ò–∑—É—á–µ–Ω–∏–µ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ DAG
- 05:28 ‚Äì –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≤ default_args
- 08:45 ‚Äì –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ DAG –∏/–∏–ª–∏ Task –≤ default_args
- 12:41 ‚Äì –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, —á—Ç–æ —Ç–∞–∫–æ–µ execution_timeout –≤ default_args
- 14:25 ‚Äì –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ pool –¥–ª—è DAG –∏/–∏–ª–∏ Task
- 17:58 ‚Äì –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ end_date –¥–ª—è DAG (–≤—Ä–µ–º—è "–∂–∏–∑–Ω–∏" DAG)
- 19:15 ‚Äì –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

#apacheairflow #airflow #dag #dagsettings #airflowdag #dataengineering #etl #elt #dwh #python #dataengineer #tutorial
#airflowtutorial #airflowforbeginners

## –û –ø—Ä–æ–µ–∫—Ç–µ

### –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
python3.12 -m venv venv && \
source venv/bin/activate && \
pip install --upgrade pip && \
pip install poetry && \
poetry lock && \
poetry install
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Airflow —á–µ—Ä–µ–∑ Docker

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Airflow, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ [Dockerfile](Dockerfile)
–∏ [docker-compose.yaml](docker-compose.yaml).

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å Airflow, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
docker-compose up -d
```

–í–µ–±-—Å–µ—Ä–≤–µ—Ä Airflow –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ —Ö–æ—Å—Ç–µ http://localhost:8080/, –µ—Å–ª–∏ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–π —Ö–æ—Å—Ç, —Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–π—Ç–∏
–ø–æ —Ö–æ—Å—Ç—É http://0.0.0.0:8080/.

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –≤ —Ç–µ–∫—É—â—É—é —Å–±–æ—Ä–∫—É

–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∫–∞–∫–æ–π-—Ç–æ –ø–∞–∫–µ—Ç –≤ —Ç–µ–∫—É—â—É—é —Å–±–æ—Ä–∫—É, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

* –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –≤ [Dockerfile](Dockerfile)
* –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É:

```bash
docker-compose build
```

* –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É:

```bash
docker-compose up -d
```
